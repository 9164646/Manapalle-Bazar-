<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Manapalle Bazar - Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0"></script>
</head>
<body style="background: #000; color: #fff; font-family: Arial, sans-serif; padding: 20px;">

<h1 class="text-center" style="color: #FFD700;">Manapalle Bazar - Lucky Draw</h1>

<div id="navigation" class="text-center mb-4">
    <button class="btn btn-warning m-2" onclick="showSection('userList')">User List</button>
    <button class="btn btn-warning m-2" onclick="showSection('rewardList')">Rewards</button>
    <button class="btn btn-warning m-2" onclick="showSection('winnerList')">Winners</button>
    <button class="btn btn-warning m-2" onclick="window.location.href='?admin=true'">Admin</button>
    <button class="btn btn-warning m-2" onclick="showSection('addUserSection')">Add User</button>

</div>
    <style>
    .hidden {
        display: none;
    }
</style>


<!-- User List -->
<div id="userList" class="hidden">
    <h2>Registered Users</h2>
    <button class="btn btn-success mb-2" onclick="exportToCSV('users')">Export Users</button>
    <table class="table table-dark">
        <thead><tr><th>S. No</th><th>Name</th><th>Coupon Code</th></tr></thead>
<tbody id="userTableBody"></tbody>

        <tbody id="userTableBody"></tbody>
    </table>
</div>


<!-- Add User Section -->
<div id="addUserSection" class="hidden">
    <h2>Add User</h2>
    <input type="text" id="userName" placeholder="User Name" class="form-control mb-2">
    <input type="text" id="userMobile" placeholder="Mobile Number" class="form-control mb-2">
    <button class="btn btn-warning" onclick="addUser()">Add User</button>
</div>

<!-- Reward List -->
<div id="rewardList" class="hidden">
    <h2>Rewards</h2>
    <table class="table table-dark">
        <thead><tr><th>S.No</th><th>Prize</th><th>Gift</th><th id="adminRewardActions" class="hidden">Actions</th></tr></thead>
        <tbody id="rewardTableBody"></tbody>
    </table>

    <div id="rewardActions" class="hidden">
        <h3>Add Reward</h3>
        <input type="text" id="rewardPrize" placeholder="Prize Name" class="form-control mb-2">
        <input type="text" id="rewardGift" placeholder="Gift Name" class="form-control mb-2">
        <button class="btn btn-warning" onclick="addReward()">Add Reward</button>
    </div>
</div>

<!-- Winner List -->
<div id="winnerList" class="hidden">
    <h2>Winners</h2>
    <button class="btn btn-success mb-2" onclick="exportToCSV('winners')">Export Winners</button>
    <table class="table table-dark">
        <thead><tr><th>List No</th><th>Name</th><th>Coupon Code</th><th>Prize</th><th id="adminWinnerActions" class="hidden">Actions</th></tr></thead>
        <tbody id="winnersTableBody"></tbody>
    </table>

    <div id="drawActions" class="hidden">
        <h3>Lucky Draw</h3>
        <input type="number" id="lotNumber" placeholder="Lot No." class="form-control mb-2">
        <button class="btn btn-warning" onclick="drawWinner()">Draw Winner</button>
    </div>
</div>

<!-- Admin Login -->
<div id="adminLogin" class="hidden">
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter Password" class="form-control mb-2">
    <button class="btn btn-warning" onclick="validateAdmin()">Login</button>
</div>

<!-- Logout Button -->
<div id="adminLogout" class="hidden text-center">
    <button class="btn btn-danger" onclick="logoutAdmin()">Logout</button>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === 'true';
    let users = JSON.parse(localStorage.getItem('users')) || [
        { name: 'John Doe', mobile: '9876543210', coupon: 'MPB-1001' }
    ];
    let rewards = JSON.parse(localStorage.getItem('rewards')) || [];
    let winners = JSON.parse(localStorage.getItem('winners')) || [];

    if (isAdmin) document.getElementById('adminLogin').classList.remove('hidden');

    function validateAdmin() {
        if (document.getElementById('adminPassword').value === '1234') {
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminRewardActions').classList.remove('hidden');
            document.getElementById('adminWinnerActions').classList.remove('hidden');
            document.getElementById('rewardActions').classList.remove('hidden');
            document.getElementById('drawActions').classList.remove('hidden');
            document.getElementById('adminLogout').classList.remove('hidden');
            renderData();
        } else alert('Wrong password!');
    }

    function logoutAdmin() {
        window.location.href = window.location.pathname;
    }

    function showSection(section) {
    // Hide all sections
    const sections = ['userList', 'rewardList', 'winnerList', 'addUserSection', 'adminLogin'];
    sections.forEach(sec => {
        document.getElementById(sec).classList.add('hidden');
    });

    // Show the selected section
    document.getElementById(section).classList.remove('hidden');
    
    // Refresh data
    renderData();
}

  function addUser() {
    const name = document.getElementById('userName').value.trim();
    const mobile = document.getElementById('userMobile').value.trim();

    if (name === '' || mobile === '') {
        alert('Please fill in all fields!');
        return;
    }
    if (!/^\d{10}$/.test(mobile)) {
        alert('Please enter a valid 10-digit mobile number!');
        return;
    }
    const newCoupon = 'MPB-' + String(users.length + 1001);
    users.push({ name, mobile, coupon: newCoupon });
    localStorage.setItem('users', JSON.stringify(users));

    // Clear input fields and refresh user list
    document.getElementById('userName').value = '';
    document.getElementById('userMobile').value = '';

    alert(`User added! Coupon Code: ${newCoupon}`);
    confetti();
    renderData();
}

    

    function addReward() {
        const prize = document.getElementById('rewardPrize').value.trim();
        const gift = document.getElementById('rewardGift').value.trim();
        if (prize && gift) {
            rewards.push({ prize, gift });
            localStorage.setItem('rewards', JSON.stringify(rewards));
            renderData();
        } else alert('Please fill in both fields!');
    }


    function drawWinner() {
        const lot = document.getElementById('lotNumber').value;
        if (winners.some(w => w.lot === lot)) {
            alert('Lot number already used!');
            return;
        }
        const winner = users[Math.floor(Math.random() * users.length)];
        const prize = rewards.shift();
        winners.push({ lot, name: winner.name, coupon: winner.coupon, prize: prize.prize });
        localStorage.setItem('winners', JSON.stringify(winners));
        localStorage.setItem('rewards', JSON.stringify(rewards));
        confetti();
        renderData();
    }

    function exportToCSV(type) {
        let data = type === 'users' ? users : winners;
        let csv = data.map(row => Object.values(row).join(",")).join("\n");
        let link = document.createElement('a');
        link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
        link.download = `${type}.csv`;
        link.click();
    }

    
function renderData() {
    // Populate User List
    const userTableBody = document.getElementById('userTableBody');
    userTableBody.innerHTML = '';
    users.forEach((user, index) => {
    userTableBody.innerHTML += `<tr><td>${index + 1}</td><td>${user.name}</td><td>${user.coupon}</td></tr>`;
});


    // Populate Reward List
    const rewardTableBody = document.getElementById('rewardTableBody');
    rewardTableBody.innerHTML = '';
    rewards.forEach((reward, index) => {
        rewardTableBody.innerHTML += `<tr><td>${index + 1}</td><td>${reward.prize}</td><td>${reward.gift}</td></tr>`;
    });

    // Populate Winner List
    const winnersTableBody = document.getElementById('winnersTableBody');
    winnersTableBody.innerHTML = '';
    winners.forEach((winner, index) => {
        winnersTableBody.innerHTML += `<tr><td>${winner.lilst}</td><td>${winner.name}</td><td>${winner.coupon}</td><td>${winner.prize}</td></tr>`;
    });
}

</script>

</body>
</html>
